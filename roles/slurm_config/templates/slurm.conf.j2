# slurm.conf file generated by Ansible
ClusterName={{ slurm_cluster_name | default('NavOps-Slurm-Cluster') }}
SlurmctldHost={{ slurm_primary_controller }}
AccountingStorageHost={{ slurm_primary_controller }}

# Process tracking
ProctrackType=proctrack/pgid
ReturnToService=2

# PID and Port configurations
SlurmctldPidFile=/run/slurm/slurmctld.pid
SlurmctldPort=6817
SlurmdPidFile=/run/slurm/slurmd.pid
SlurmdPort=6818
SlurmdSpoolDir=/var/spool/slurmd
SlurmUser=slurm

# State save location
StateSaveLocation=/var/spool/slurmctld

# TIMERS
InactiveLimit=0
KillWait=30
MinJobAge=300
SlurmctldTimeout=120
SlurmdTimeout=300
Waittime=0

# SCHEDULING
SchedulerType=sched/backfill
SelectType=select/cons_tres
MaxNodeCount=1024

# LOGGING AND ACCOUNTING
AccountingStorageType=accounting_storage/slurmdbd
AccountingStorageUser=slurm
JobAcctGatherFrequency=30
JobAcctGatherType=jobacct_gather/none
SlurmctldDebug=info
SlurmctldLogFile=/var/log/slurm/slurmctld.log
SlurmdDebug=info
SlurmdLogFile=/var/log/slurm/slurmd.log

# DYNAMIC NODE LIST - All nodes get same list
{% for host in groups['slurm_computes'] %}
NodeName={{ hostvars[host]['ansible_hostname'] }} CPUs={{ hostvars[host].ansible_processor_vcpus | default(4) }} State=UNKNOWN
{% endfor %}

# DYNAMIC PARTITION
PartitionName=debug Nodes={% for host in groups['slurm_computes'] %}{{ hostvars[host]['ansible_hostname'] }}{% if not loop.last %},{% endif %}{% endfor %} Default=YES MaxTime=INFINITE State=UP
